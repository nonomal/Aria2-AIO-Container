# Created by wy580477 for customized container <https://github.com/wy580477>
{
        storage file_system /mnt/config/caddy
        log {
                exclude http.handlers.reverse_proxy
        }
}
DOMAIN:WEB_PORT
tls EMAIL
encode gzip
# Configure Homer
@exclude {
        not path PORTAL_PATH/ariang/*
        not path PORTAL_PATH/rclonerc/*
        not path PORTAL_PATH/rcloneweb/*
        not path PORTAL_PATH/files/*
        not path PORTAL_PATH/ariang
        not path PORTAL_PATH/rclonerc
        not path PORTAL_PATH/rcloneweb
        not path PORTAL_PATH/jsonrpc
        not path PORTAL_PATH/files
}
route @exclude {
        uri strip_prefix "PORTAL_PATH"
        basicauth * {
                USER HASH
        }
        root * /.aria2allinoneworkdir/homer
        file_server
}
# Configure AriaNg
route PORTAL_PATH/ariang/* {
        uri strip_prefix PORTAL_PATH/ariang
        basicauth * {
                USER HASH
        }
        root * /.aria2allinoneworkdir/ariang
        file_server
}
redir PORTAL_PATH/ariang PORTAL_PATH/ariang/ 301
# Configure Rclone Web UI
route PORTAL_PATH/rcloneweb/* {
        uri strip_prefix PORTAL_PATH/rcloneweb
        basicauth * {
                USER HASH
        }
        root * /.aria2allinoneworkdir/rcloneweb/build
        file_server
}
redir PORTAL_PATH/rcloneweb PORTAL_PATH/rcloneweb/ 301
# Configure Rclone Serve
route PORTAL_PATH/rclonerc/* {
        uri strip_prefix PORTAL_PATH/rclonerc
        reverse_proxy * localhost:56802
}
# Configure Aria2 RPC
route PORTAL_PATH/jsonrpc {
        uri replace PORTAL_PATH/jsonrpc /jsonrpc
        reverse_proxy /jsonrpc localhost:56800
}
# Configure Filebrowser
reverse_proxy PORTAL_PATH/files/* localhost:56801
redir PORTAL_PATH/files PORTAL_PATH/files/ 301
# Configure Rclone RC
route PORTAL_PATH/rclonerc {
        uri strip_prefix PORTAL_PATH/rclonerc
        reverse_proxy * localhost:56802
}
